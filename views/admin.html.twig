{% extends "layout.html.twig" %}
{% set adminMenu = true %}

{% block title %}Administration{% endblock %}

{% block content %}
<div class="page-header text-center">
    <h1>{{ block('title') }}</h1>
</div>

{% for flashMessage in app.session.flashbag.get('success') %}
    <div class="alert alert-success">{{ flashMessage }}</div>
{% endfor %}

<ul class="nav nav-pills nav-justified" role="tablist" style="margin-bottom: 18px;">
    <li class="active"><a href="#links" data-toggle="tab">Links</a></li>
    <li><a href="#users" data-toggle="tab">Users</a></li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade in active" id="links">
        <div class="panel panel-default adminTable">
            <div class="panel-heading clearfix">
                <strong class="pull-left">Links</strong>
                <a href="{{ path('admin_link_add') }}" class="btn btn-primary btn-sm pull-right">
                    <span class="glyphicon glyphicon-plus"></span> Add link
                </a>
            </div>

            <div class="panel-body">
                {% if links %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-condensed">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Author</th>
                                    <th>Description</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for link in links %}
                                <tr>
                                    <td><a class="linkTitle" href="{{ path('link', { 'id': link.id }) }}">{{ link.title }}</a></td>
                                    <td>{{ link.user.username }}</td>
                                    <td>{{ link.desc | truncate(60) }}</td>
                                    <td>
                                        <a href="{{ path('admin_link_edit', { 'id': link.id }) }}" class="btn btn-info btn-xs" title="Edit">
                                            <span class="glyphicon glyphicon-edit"></span>
                                        </a>

                                        <button type="button" class="btn btn-danger btn-xs" title="Delete" data-toggle="modal" data-target="#linkDialog{{ link.id }}">
                                            <span class="glyphicon glyphicon-remove"></span>
                                        </button>

                                        <div class="modal fade" id="linkDialog{{ link.id }}" tabindex="-1" role="dialog" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                        <h4 class="modal-title">Confirmation needed</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        Do you really want to delete this link ?
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                                        <a href="{{ path('admin_link_delete', { 'id': link.id }) }}" class="btn btn-danger">Confirm</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                        {% if links and totalPages > 1 %}
                        <div class="text-center">
                            <nav aria-label="Page navigation">
                                <ul class="pagination">
                                    <li {% if currentPage == 1 %}class="disabled"{% endif %}>
                                        <a href="{% if currentPage > 1 %}{{ path('admin', { 'page': currentPage - 1 }) }}{% else %}#{% endif %}" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                        {% for i in range(1, totalPages) %}
                                        <li {% if currentPage == i %}class="active"{% endif %}>
                                        <a href="{{ path('admin', { 'page': i }) }}">{{ i }}</a>
                                    </li>
                        {% endfor %}
                            <li {% if currentPage == totalPages %}class="disabled"{% endif %}>
                               <a href="{% if currentPage < totalPages %}{{ path('admin', { 'page': currentPage + 1 }) }}{% else %}#{% endif %}" aria-label="Next">
                                  <span aria-hidden="true">&raquo;</span>
                               </a>
                            </li>
                        </ul>
                    </nav>
    
                  <p class="text-muted">Affichage de {{ ((currentPage - 1) * perPage) + 1 }} Ã  {% set maxDisplay = currentPage * perPage %}{% if maxDisplay > totalLinks %}{{ totalLinks }}{% else %}{{ maxDisplay }}{% endif %} sur {{ totalLinks }} liens</p>
                </div>
            {% endif %}
                        
                    </div>
                {% else %}
                    <div class="alert alert-warning">No links found.</div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="tab-pane fade" id="users">
        <div class="panel panel-default adminTable">
            <div class="panel-heading clearfix">
                <strong class="pull-left">Users</strong>
                <a href="{{ path('admin_user_add') }}" class="btn btn-primary btn-sm pull-right">
                    <span class="glyphicon glyphicon-plus"></span> Add user
                </a>
            </div>

            <div class="panel-body">
                {% if users %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover table-condensed">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for user in users %}
                                <tr>
                                    <td>{{ user.username }}</td>
                                    <td>
                                        <a href="{{ path('admin_user_edit', { 'id': user.id }) }}" class="btn btn-info btn-xs" title="Edit">
                                            <span class="glyphicon glyphicon-edit"></span>
                                        </a>

                                        <button type="button" class="btn btn-danger btn-xs" title="Delete" data-toggle="modal" data-target="#userDialog{{ user.id }}">
                                            <span class="glyphicon glyphicon-remove"></span>
                                        </button>

                                        <div class="modal fade" id="userDialog{{ user.id }}" tabindex="-1" role="dialog" aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                        <h4 class="modal-title">Confirmation needed</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        Do you really want to delete this user ?
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                                        <a href="{{ path('admin_user_delete', { 'id': user.id }) }}" class="btn btn-danger">Confirm</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-warning">No users found.</div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
